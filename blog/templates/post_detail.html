{% extends 'base.html' %}
{% load static %}

{% block title %}{{ post.title }} | Scribo{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      
      <!-- Post Card -->
      <div class="glass-card p-4 mb-4">
        <h2 class="text-center mb-2 text-black">{{ post.title }}</h2>
        <p class="text-muted mb-1">
          By {{ post.author }} ‚Ä¢ Created: {{ post.created_at|date:"F d, Y" }}
          {% if post.created_at != post.updated_at %}
            ‚Ä¢ Updated: {{ post.updated_at|date:"F d, Y" }}
          {% endif %}
        </p>

        <!-- Post Image -->
        {% if post.image %}
          <img src="{{ post.image.url }}" class="img-fluid rounded mb-3" alt="Post Image">
        {% endif %}

        
        <p>{{ post.content }}</p>

        <!-- Like + Edit/Delete -->
        <div class="d-flex justify-content-between align-items-center mt-3">
          <form id="like-form" method="post" action="{% url 'like_post_ajax' post.id %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-like like-btn border-0 bg-transparent p-0">
              {% if user in post.likes.all %}‚ù§Ô∏è{% else %}ü§ç{% endif %}
            </button>
            <span id="like-count">{{ post.likes.count }}</span>
          </form>

          {% if request.user == post.author %}
          <div>
            <a href="{% url 'edit_post' post.id %}" class="btn btn-sm btn-outline-secondary">Edit</a>
            <a href="{% url 'delete_post' post.id %}" class="btn btn-sm btn-outline-danger">Delete</a>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Comments Section -->
      <div class="glass-card p-4">
        <h5 class="text-center mb-2 text-black">Comments</h5>

       
       <!-- Comments List -->
<div id="comment-list">
  {% for comment in post.comments.all %}
    <div class="bg-white/40 p-3 rounded-xl border border-gray-200 backdrop-blur-md mb-2">
      <div class="d-flex justify-content-between text-muted small mb-1">
        <strong>{{ comment.author.username }}</strong>
        <span>{{ comment.created_at|date:"F d, Y H:i" }}</span>
      </div>
      <p class="mb-0">{{ comment.text }}</p>
    </div>
  {% endfor %}
</div>


        <!-- Add Comment -->
        {% if request.user.is_authenticated %}
        <form id="comment-form" method="post" action="{% url 'add_comment' post.id %}" class="mt-4">
          {% csrf_token %}
          <div class="mb-3">
            <textarea id="comment-text" name="content" class="form-control" rows="3" placeholder="Write a comment..." required></textarea>
          </div>
          <button type="submit" class="btn btn-dark mt-4 px-4"> Add Comment</button>
        </form>
        {% else %}
        <p class="text-muted mt-3">Login to comment.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>


<script src="{% static 'js/post_detail.js' %}"></script>
{% endblock %}
